# DamageRuleLoot 伤害规则掉落

- 作者: 羽学、西江小子
- 出处: Tshock官方QQ群816771079
- 根据玩家输出百分比决定是否掉落宝藏袋，从伤害统计插件基础上进行二创。

## 指令

| 语法      |  别名 |                         权限                        |   说明   |
| ------- | :-: | :-----------------------------------------------: | :----: |
| /reload |  无  | tshock.cfg.reload | 重载配置文件 |

---

## 主体配置注意事项

1.玩家对BOSS的`伤害百分比`超过`低于多少不掉宝藏袋`的百分比才能捡到`宝藏袋`

2.`参与伤害榜的非BOSS怪ID`的不会参与惩罚榜播报，其中`火星飞碟`和`荷兰飞盗船`已经过处理，切勿删除。

3.`惩罚榜`播报只关联有宝藏袋的BOSS

4.`监控暴击次数`会监控所有正在产生暴击的玩家，`监控转移伤害`为监控转移伤害状态，该功能为开发者专用，切勿开启，否则会刷屏。

5.`天顶新三王统计为美杜莎伤害榜`仅在天顶世界有效，如果关闭则会独立播报天顶世界中新三王的各别所受伤害，反之播报美杜莎整体伤害，正常世界不受该配置项影响。

6.`攻击机械吴克四肢造成真实伤害`开启后数值会超出BOSS血量，同时能对肢体造成血量伤害。

7.`攻击鲨鱼龙给猪鲨造成真实伤害`可以让其他玩家在清理鲨鱼龙时给主力启到实际的辅助作用（实打实的会扣猪鲨的血量），同样数值会超出BOSS血量

8.`攻击小鬼与饿鬼给肉山造成真伤`只在FTW和天顶种子生效，同样数值会超出BOSS血量

9.如不需要参与惩罚则可以关闭`是否惩罚`

---

## 自定义转移伤害表注意事项

`自定义转移伤害表`在列表`[]`里面的最后，输入`,{}`然后使用`/reload`指令，可得到一份新格式（并预设好了参数）

`转移伤害`只有在任何一个玩家，击中一次BOSS才会生效

`怪物名称`根据`受伤怪物`的NPC ID 在使用`/reload`指令时自动写入，无需手动填写

`停转生命`根据`受伤怪物`生命到达多少不再触发转移伤害

`最低转伤`为触发转发伤害的最低下限

`最高转伤`为拦截转发伤害的最高上限

`涵盖暴击`根据对`转伤怪物`所有伤害转移,关闭后所有触发`暴击`的伤害都不会转移

`播报排名`根据`受伤怪物`来提示排名

`伤值进榜`把对`转伤怪物`造成的伤害值统计进输出排行榜

## 配置

```json5
{
  "插件开关": true,
  "是否惩罚": true,
  "广告开关": true,
  "广告内容": "[i:3456][C/F2F2C7:插件开发] [C/BFDFEA:by]  羽学 [C/E7A5CC:|] [c/00FFFF:西江小子][i:3459]",
  "伤害榜播报": true,
  "惩罚榜播报": true,
  "低于多少不掉宝藏袋": 0.15,
  "天顶新三王统计为美杜莎伤害榜": true,
  "忽略计算石巨人头部输出榜伤害": false,
  "攻击机械吴克四肢造成真实伤害": true,
  "攻击鲨鱼龙给猪鲨造成真实伤害": true,
  "攻击小鬼与饿鬼给肉山造成真伤(仅FTW与天顶)": true,
  "参与伤害榜的非BOSS怪ID": [
    243,
    541,
    473,
    474,
    475,
    564,
    565,
    576,
    577,
    471,
    491,
    618,
    620,
    621,
    622,
    623,
    216,
    392
  ],
  "监控暴击次数": false,
  "监控转移伤害": false,
  "自定义转移伤害": true,
  "自定义转移伤害表": [
    {
      "怪物名称": "克苏鲁之眼",
      "受伤怪物": 4,
      "停转血量": 600,
      "最低转伤": 1,
      "最高转伤": 200,
      "涵盖暴击": false,
      "播报排名": true,
      "伤值进榜": true,
      "转伤怪物": [
        5
      ]
    },
    {
      "怪物名称": "史莱姆王",
      "受伤怪物": 50,
      "停转血量": 800,
      "最低转伤": 1,
      "最高转伤": 200,
      "涵盖暴击": true,
      "播报排名": true,
      "伤值进榜": true,
      "转伤怪物": [
        1,
        535
      ]
    },
    {
      "怪物名称": "世纪之花",
      "受伤怪物": 262,
      "停转血量": 10000,
      "最低转伤": 1,
      "最高转伤": 1000,
      "涵盖暴击": true,
      "播报排名": true,
      "伤值进榜": true,
      "转伤怪物": [
        264
      ]
    }
  ]
}
```

## 更新日志

```
v1.3.1
对代码做了重复部分做成统一方法整理归纳
修复了自定义转移伤害表里的【涵盖暴击】配置项
给自定义转移伤害加了更多配置项：
【怪物名称】/reload时自动根据【受伤怪物】的ID写入
【最低转伤】触发转发伤害的最低下限
【最高转伤】触发转发伤害的最高上限
【播报排名】是否播报【受伤怪物】的输出排名
移除了【是否排除计算石巨人头部伤害】配置项

v1.3.0
给伤害榜标题加了渐变色
所有转移伤害都视为真伤，加入了自定义转移伤害表
加入了攻击小鬼与饿鬼给肉山造成真实伤害配置项
将机械骷髅王计入四肢伤害视为虚值改为造成真伤
给转移伤害加了雕像怪判断
给杀怪建表加了城镇npc、雕像怪、假人判断
自定义转移伤害表有自己的伤害统计逻辑（非真实血量数值）

v1.2.3
加入了对火星飞船的特殊处理
加入了美杜莎的判定与特殊处理
加入了开发者专用的暴击监控配置项
加入忽略石巨人头部伤害配置项
加入计算机械骷髅王四肢伤害配置项（虚标）
加入攻击鲨鱼龙给猪鲨造成真实伤害配置项

v1.2.2
再次重构《伤怪建表法》，使伤害更接近准确数值
加入对暴击连续统计播报与怯战人数播报

v1.2.1
加入对暴击伤害计数法来归纳玩家的真实伤害
将广告内容放到了Config方便玩家自定义

v1.2.0
重构全部代码，以枳的伤害统计插件作为基础二次开发

对各别分体化的BOSS伤害输出做了特殊处理
美化了输出榜播报内容
加入了额外伤害榜NPC扩展项
加入了惩罚榜与伤害榜的独立开关配置项

v1.1.0
移除了大部分不需要的参数
把《玩家输出表》转换成了字典键值方便参考观看
优化了多BOSS场景下也能判断宝藏袋掉落

v1.0.0
从伤害统计插件基础上进行二创的伤害规则掉落插件
新玩家进服会自动创建【玩家数据表】，如果玩家已经在配置里则会清空【伤害值】
玩家对BOSS的【伤害百分比】超过【领取条件】的百分比才能捡到【物品ID】内的物品

```

## 反馈

- 优先发issued -> 共同维护的插件库：https://github.com/UnrealMultiple/TShockPlugin
- 次优先：TShock官方群：816771079
- 大概率看不到但是也可以：国内社区trhub.cn ，bbstr.net , tr.monika.love
